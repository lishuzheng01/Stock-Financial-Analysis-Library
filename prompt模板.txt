import pandas as pd
import numpy as np
from pandas.core.missing import F
from stock_tool.get_report_data import get_report_data
import os

# set stock code
stock = "600519"

# get the report data
pd_asset = get_report_data(stock=stock, symbol="资产负债表",transpose=False)
pd_income = get_report_data(stock=stock, symbol="利润表",transpose=False)
pd_cashflow = get_report_data(stock=stock, symbol="现金流量表",transpose=False)

# get the head of all tolist
print("pd_asset columns:")
print(pd_asset.columns.tolist())
print("pd_income columns:")
print(pd_income.columns.tolist())
print("pd_cashflow columns:")
print(pd_cashflow.columns.tolist())

# get the report data
pd_asset = get_report_data(stock=stock, symbol="资产负债表",transpose=True)
pd_income = get_report_data(stock=stock, symbol="利润表",transpose=True)
pd_cashflow = get_report_data(stock=stock, symbol="现金流量表",transpose=True)

# get the head of all tolist
print("pd_asset columns:")
print(pd_asset.columns.tolist())
print("pd_income columns:")
print(pd_income.columns.tolist())
print("pd_cashflow columns:")
print(pd_cashflow.columns.tolist())
'''
(d:\Files\Code\Stocking\.conda) PS D:\Files\Code\Stocking> & d:/Files/Code/Stocking/.conda/python.exe d:/Files/Code/Stocking/BeneishM-Score.py
pd_asset columns:
['报告日', 'Current Assets', 'Cash and Cash Equivalents', 'Provision for Settlement', 'Funds Lent', 'Trading Financial Assets', 'Financial Assets Purchased under Resale Agreements', 'Derivative Financial Assets', 'Notes and Accounts Receivable', 'Notes Receivable', 'Accounts Receivable', 'Accounts Receivable Financing', 'Prepayments', 'Dividends Receivable', 'Interest Receivable', 'Premiums Receivable', 'Reinsurance Accounts Receivable', 'Reinsurance Contract Reserve Receivable', 'Export Tax Rebate Receivable', 'Subsidies Receivable', 'Margin Receivable', 'Internal Receivables', 'Other Receivables', 'Total Other Receivables', 'Inventories', 'Assets Classified as Held for Sale', 'Deferred Expenses', 'Gains and Losses on Disposal of Current Assets', 'Non-current Assets Due within One Year', 'Other Current Assets', 'Total Current Assets', 'Non-current Assets', 'Loans and Advances', 'Debt Investment', 'Other Debt Investment', 'Financial Assets at Fair Value through Other Comprehensive Income', 'Financial Assets at Amortized Cost', 'Available-for-Sale Financial Assets', 'Long-term Equity Investments', 'Investment Property', 'Long-term Receivables', 'Other Equity Instrument Investments', 'Other Non-current Financial Assets', 'Other Long-term Investments', 'Cost of Fixed Assets', 'Accumulated Depreciation', 'Net Value of Fixed Assets', 'Impairment Provision for Fixed Assets', 'Total Construction in Progress', 'Construction in Progress', 'Engineering Materials', 'Net Fixed Assets', 'Disposal of Fixed Assets', 'Total Fixed Assets and Disposal', 'Productive Biological Assets', 'Public Welfare Biological Assets', 'Oil and Gas Assets', 'Contract Assets', 'Right-of-Use Assets', 'Intangible Assets', 'Development Expenditures', 'Goodwill', 'Long-term Deferred Expenses', 'Equity Division and Circulation Rights', 'Deferred Tax Assets', 'Other Non-current Assets', 'Total Non-current Assets', 'Total Assets', 'Current Liabilities', 'Short-term Borrowings', 'Borrowings from Central Bank', 'Deposits from Customers and Interbank Deposits', 'Funds Borrowed', 'Trading Financial Liabilities', 'Derivative Financial Liabilities', 'Notes and Accounts Payable', 'Notes Payable', 'Accounts Payable', 'Advances from Customers', 'Contract Liabilities', 'Financial Assets Sold under Repurchase Agreements', 'Fees and Commissions Payable', 'Employee Benefits Payable', 'Taxes Payable', 'Interest Payable', 'Dividends Payable', 'Margin Payable', 'Internal Payables', 'Other Payables', 'Total Other Payables', 'Other Taxes Payable', 'Provision for Guarantee Compensation', 'Reinsurance Accounts Payable', 'Insurance Contract Reserves', 'Funds for Securities Trading on behalf of Clients', 'Funds for Securities Underwriting on behalf of Clients', 'International Ticket Settlement', 'Domestic Ticket Settlement', 'Accrued Expenses', 'Estimated Current Liabilities', 'Short-term Bonds Payable', 'Liabilities Classified as Held for Sale', 'Deferred Income Due within One Year', 'Non-current Liabilities Due within One Year', 'Other Current Liabilities', 'Total Current Liabilities', 'Non-current Liabilities', 'Long-term Borrowings', 'Bonds Payable', 'Bonds Payable: Preferred Shares', 'Bonds Payable: Perpetual Bonds', 'Lease Liabilities', 'Long-term Employee Benefits Payable', 'Long-term Payables', 'Total Long-term Payables', 'Special Payables', 'Estimated Non-current Liabilities', 'Long-term Deferred Income', 'Deferred Tax Liabilities', 'Other Non-current Liabilities', 'Total Non-current Liabilities', 'Total Liabilities', "Owner's Equity", 'Paid-in Capital (or Share Capital)', 'Other Equity Instruments', 'Preferred Shares', 'Perpetual Bonds', 'Capital Reserve', 'Less: Treasury Stock', '其他综合收益', 'Special Reserve', 'Surplus Reserve', 'General Risk Reserve', 'Undetermined Investment Losses', 'Retained Earnings', 'Proposed Cash Dividends', 'Foreign Currency Translation Differences', 'Total Equity Attributable to Shareholders of the Parent Company', 'Minority Interest', "Total Owner's Equity (or Shareholders' Equity)", "Total Liabilities and Owner's Equity (or Shareholders' Equity)", '数据源', '是否审计', '公告日期', '币种', '类型', '更新日期']
pd_income columns:
['Report Date', 'Total Operating Revenue', 'Operating Revenue', 'Interest Income', 'Earned Premiums', 'Fee and Commission Income', 'Real Estate Sales Revenue', 'Other Business Revenue', 'Total Operating Costs', 'Operating Costs', 'Fee and Commission Expenses', 'Real Estate Sales Costs', 'Surrender Value', 'Net Claim Expenses', 'Net Provision for Insurance Contracts', 'Policyholder Dividend Expenses', 'Reinsurance Expenses', 'Other Business Costs', 'Taxes and Surcharges', 'R&D Expenses', 'Selling Expenses', 'Administrative Expenses', 'Financial Expenses', 'Interest Expenses', 'Interest Payables', 'Investment Income', 'Income from Associates and JVs', 'Gain on Derecognition of Amortized Cost Fin. Assets', 'Exchange Gains', 'Net Exposure Hedging Gains', 'Fair Value Change Income', 'Futures Profit/Loss', 'Custodian Income', 'Subsidy Income', 'Other Income', 'Asset Impairment Loss', 'Credit Impairment Loss', 'Other Business Profit', 'Asset Disposal Income', 'Operating Profit', 'Non-operating Income', 'Gain on Disposal of Non-current Assets', 'Non-operating Expenses', 'Loss on Disposal of Non-current Assets', 'Total Profit', 'Income Tax Expenses', 'Unrecognized Investment Loss', 'Net Profit', 'Net Profit from Continuing Operations', 'Net Profit from Discontinued Operations', 'Net Profit Attributable to Parent', 'Net Profit of Merged Party Before Merger', 'Minority Interest Income', 'Other Comprehensive Income (OCI)', 'OCI Attributable to Parent', '(I) Items not to be reclassified to P&L', 'Remeasurement of Defined Benefit Plans', 'Share of OCI of Associates (Non-recyclable)', 'Fair Value Changes of Other Equity Instruments', 'Fair Value Changes due to Own Credit Risk', '(II) Items to be reclassified to P&L', 'Share of OCI of Associates (Recyclable)', 'Fair Value Changes of Available-for-Sale Fin. Assets', 'Fair Value Changes of Other Debt Investments', 'Amt. of Fin. Assets Reclassified to OCI', 'Credit Impairment Provision for Other Debt Inv.', 'Gains/Losses on Reclassification of HTM to AFS', 'Cash Flow Hedge Reserve', 'Effective Portion of Cash Flow Hedges', 'Foreign Currency Translation Differences', 'Others', 'OCI Attributable to Minority Shareholders', 'Total Comprehensive Income', 'Total Comp. Income Attrib. to Parent', 'Total Comp. Income Attrib. to Minority', 'Basic EPS', 'Diluted EPS', 'Data Source', 'Audit Status', 'Announcement Date', 'Currency', 'Report Type', 'Update Date']
pd_cashflow columns:
['Report Date', 'Cash Flows from Operating Activities', 'Cash Received from Sales of Goods and Rendering of Services', 'Net Increase in Customer Deposits and Interbank Deposits', 'Net Increase in Borrowings from Central Bank', 'Net Increase in Funds Borrowed from Other Financial Institutions', 'Cash Received from Premiums of Original Insurance Contracts', 'Net Cash Received from Reinsurance Business', 'Net Increase in Deposits and Investments from Policyholders', 'Net Increase in Cash from Disposal of Trading Financial Assets', 'Cash Received from Interest, Fees, and Commissions', 'Net Increase in Funds Borrowed', 'Net Increase in Funds from Repurchase Business', 'Tax Refunds Received', 'Other Cash Received Relating to Operating Activities', 'Subtotal of Cash Inflows from Operating Activities', 'Cash Paid for Goods and Services', 'Net Increase in Loans and Advances to Customers', 'Net Increase in Deposits with Central Bank and Interbank Deposits', 'Cash Paid for Claims of Original Insurance Contracts', 'Cash Paid for Interest, Fees, and Commissions', 'Cash Paid for Policy Dividends', 'Cash Paid to and for Employees', 'Taxes Paid', 'Other Cash Paid Relating to Operating Activities', 'Subtotal of Cash Outflows from Operating Activities', 'Net Cash Flow from Operating Activities', 'Cash Flows from Investing Activities', 'Cash Received from Return of Investments', 'Cash Received from Investment Income', 'Net Cash Received from Disposal of Fixed Assets, Intangible Assets, and Other Long-term Assets', 'Net Cash Received from Disposal of Subsidiaries and Other Business Units', 'Other Cash Received Relating to Investing Activities', 'Cash Received from Decrease in Pledged and Time Deposits', 'Net Increase in Cash from Disposal of Available-for-Sale Financial Assets', 'Subtotal of Cash Inflows from Investing Activities', 'Cash Paid for Acquisition of Fixed Assets, Intangible Assets, and Other Long-term Assets', 'Cash Paid for Investments', 'Net Increase in Pledged Loans', 'Net Cash Paid for Acquisition of Subsidiaries and Other Business Units', 'Cash Paid for Increase in Pledged and Time Deposits', 'Other Cash Paid Relating to Investing Activities', 'Subtotal of Cash Outflows from Investing Activities', 'Net Cash Flow from Investing Activities', 'Cash Flows from Financing Activities', 'Cash Received from Capital Contributions', "Cash Received by Subsidiaries from Minority Shareholders' Investments", 'Cash Received from Borrowings', 'Cash Received from Issuing Bonds', 'Other Cash Received Relating to Financing Activities', 'Subtotal of Cash Inflows from Financing Activities', 'Cash Paid for Repayment of Debts', 'Cash Paid for Distribution of Dividends, Profits, or Payment of Interest', 'Dividends and Profits Paid by Subsidiaries to Minority Shareholders', 'Other Cash Paid Relating to Financing Activities', 'Subtotal of Cash Outflows from Financing Activities', 'Net Cash Flow from Financing Activities', 'Effect of Foreign Exchange Rate Changes on Cash and Cash Equivalents', 'Net Increase in Cash and Cash Equivalents', 'Opening Balance of Cash and Cash Equivalents', 'Closing Balance of Cash', 'Opening Balance of Cash', 'Closing Balance of Cash Equivalents', 'Opening Balance of Cash Equivalents', 'Closing Balance of Cash and Cash Equivalents', 'Data Source', 'Audit Status', 'Announcement Date', 'Currency', 'Report Type', 'Update Date']    
pd_asset columns:
['报告日', '流动资产', '货币资金', '结算备付金', '拆出资金', '交易性金融资产', '买入返售金融资产', '衍生金融资产', '应收 票据及应收账款', '应收票据', '应收账款', '应收款项融资', '预付款项', '应收股利', '应收利息', '应收保费', '应收分保账款', '应收分保合同准备金', '应收出口退税', '应收补贴款', '应收保证金', '内部应收款', '其他应收款', '其他应收款(合计)', '存货', '划分为持有待售的资产', '待摊费用', '待处理流动资产损益', '一年内到期的非流动资产', '其他流动资产', '流动资产合计', '非 流动资产', '发放贷款及垫款', '债权投资', '其他债权投资', '以公允价值计量且其变动计入其他综合收益的金融资产', '以摊余成本 计量的金融资产', '可供出售金融资产', '长期股权投资', '投资性房地产', '长期应收款', '其他权益工具投资', '其他非流动金融资 产', '其他长期投资', '固定资产原值', '累计折旧', '固定资产净值', '固定资产减值准备', '在建工程合计', '在建工程', '工程物 资', '固定资产净额', '固定资产清理', '固定资产及清理合计', '生产性生物资产', '公益性生物资产', '油气资产', '合同资产', ' 使用权资产', '无形资产', '开发支出', '商誉', '长期待摊费用', '股权分置流通权', '递延所得税资产', '其他非流动资产', '非流 动资产合计', '资产总计', '流动负债', '短期借款', '向中央银行借款', '吸收存款及同业存放', '拆入资金', '交易性金融负债', ' 衍生金融负债', '应付票据及应付账款', '应付票据', '应付账款', '预收款项', '合同负债', '卖出回购金融资产款', '应付手续费及 佣金', '应付职工薪酬', '应交税费', '应付利息', '应付股利', '应付保证金', '内部应付款', '其他应付款', '其他应付款合计', ' 其他应交款', '担保责任赔偿准备金', '应付分保账款', '保险合同准备金', '代理买卖证券款', '代理承销证券款', '国际票证结算', '国内票证结算', '预提费用', '预计流动负债', '应付短期债券', '划分为持有待售的负债', '一年内的递延收益', '一年内到期的非流动负债', '其他流动负债', '流动负债合计', '非流动负债', '长期借款', '应付债券', '应付债券：优先股', '应付债券：永续债', ' 租赁负债', '长期应付职工薪酬', '长期应付款', '长期应付款合计', '专项应付款', '预计非流动负债', '长期递延收益', '递延所得 税负债', '其他非流动负债', '非流动负债合计', '负债合计', '所有者权益', '实收资本(或股本)', '其他权益工具', '优先股', '永 续债', '资本公积', '减:库存股', '其他综合收益', '专项储备', '盈余公积', '一般风险准备', '未确定的投资损失', '未分配利润', '拟分配现金股利', '外币报表折算差额', '归属于母公司股东权益合计', '少数股东权益', '所有者权益(或股东权益)合计', '负债和 所有者权益(或股东权益)总计', '数据源', '是否审计', '公告日期', '币种', '类型', '更新日期']
pd_income columns:
['报告日', '营业总收入', '营业收入', '利息收入', '已赚保费', '手续费及佣金收入', '房地产销售收入', '其他业务收入', '营业 总成本', '营业成本', '手续费及佣金支出', '房地产销售成本', '退保金', '赔付支出净额', '提取保险合同准备金净额', '保单红利 支出', '分保费用', '其他业务成本', '营业税金及附加', '研发费用', '销售费用', '管理费用', '财务费用', '利息费用', '利息支 出', '投资收益', '对联营企业和合营企业的投资收益', '以摊余成本计量的金融资产终止确认产生的收益', '汇兑收益', '净敞口套期 收益', '公允价值变动收益', '期货损益', '托管收益', '补贴收入', '其他收益', '资产减值损失', '信用减值损失', '其他业务利润', '资产处置收益', '营业利润', '营业外收入', '非流动资产处置利得', '营业外支出', '非流动资产处置损失', '利润总额', '所得税费用', '未确认投资损失', '净利润', '持续经营净利润', '终止经营净利润', '归属于母公司所有者的净利润', '被合并方在合并前实 现净利润', '少数股东损益', '其他综合收益', '归属于母公司所有者的其他综合收益', '（一）以后不能重分类进损益的其他综合收益', '重新计量设定受益计划变动额', '权益法下不能转损益的其他综合收益', '其他权益工具投资公允价值变动', '企业自身信用风险公允价值变动', '（二）以后将重分类进损益的其他综合收益', '权益法下可转损益的其他综合收益', '可供出售金融资产公允价值变动损益', '其他债权投资公允价值变动', '金融资产重分类计入其他综合收益的金额', '其他债权投资信用减值准备', '持有至到期投资重分类为可供出售金融资产损益', '现金流量套期储备', '现金流量套期损益的有效部分', '外币财务报表折算差额', '其他', '归属于少数股东 的其他综合收益', '综合收益总额', '归属于母公司所有者的综合收益总额', '归属于少数股东的综合收益总额', '基本每股收益', '稀 释每股收益', '数据源', '是否审计', '公告日期', '币种', '类型', '更新日期']
pd_cashflow columns:
['报告日', '经营活动产生的现金流量', '销售商品、提供劳务收到的现金', '客户存款和同业存放款项净增加额', '向中央银行借款净 增加额', '向其他金融机构拆入资金净增加额', '收到原保险合同保费取得的现金', '收到再保险业务现金净额', '保户储金及投资款净 增加额', '处置交易性金融资产净增加额', '收取利息、手续费及佣金的现金', '拆入资金净增加额', '回购业务资金净增加额', '收到 的税费返还', '收到的其他与经营活动有关的现金', '经营活动现金流入小计', '购买商品、接受劳务支付的现金', '客户贷款及垫款净 增加额', '存放中央银行和同业款项净增加额', '支付原保险合同赔付款项的现金', '支付利息、手续费及佣金的现金', '支付保单红利 的现金', '支付给职工以及为职工支付的现金', '支付的各项税费', '支付的其他与经营活动有关的现金', '经营活动现金流出小计', ' 经营活动产生的现金流量净额', '投资活动产生的现金流量', '收回投资所收到的现金', '取得投资收益收到的现金', '处置固定资产、 无形资产和其他长期资产所收回的现金净额', '处置子公司及其他营业单位收到的现金净额', '收到的其他与投资活动有关的现金', '减 少质押和定期存款所收到的现金', '处置可供出售金融资产净增加额', '投资活动现金流入小计', '购建固定资产、无形资产和其他长期 资产所支付的现金', '投资所支付的现金', '质押贷款净增加额', '取得子公司及其他营业单位支付的现金净额', '增加质押和定期存款 所支付的现金', '支付的其他与投资活动有关的现金', '投资活动现金流出小计', '投资活动产生的现金流量净额', '筹资活动产生的现 金流量', '吸收投资收到的现金', '子公司吸收少数股东投资收到的现金', '取得借款收到的现金', '发行债券收到的现金', '收到其他 与筹资活动有关的现金', '筹资活动现金流入小计', '偿还债务支付的现金', '分配股利、利润或偿付利息所支付的现金', '子公司支付 给少数股东的股利、利润', '支付其他与筹资活动有关的现金', '筹资活动现金流出小计', '筹资活动产生的现金流量净额', '汇率变动 对现金及现金等价物的影响', '现金及现金等价物净增加额', '期初现金及现金等价物余额', '现金的期末余额', '现金的期初余额', ' 现金等价物的期末余额', '现金等价物的期初余额', '期末现金及现金等价物余额', '数据源', '是否审计', '公告日期', '币种', '类 型', '更新日期']
(d:\Files\Code\Stocking\.conda) PS D:\Files\Code\Stocking> 

'''

实现以下功能，形式的使用功能，方便在其他文件中调用
# 从其他文件导入
from stock_tool.BeneishMScore import analyze_beneish_mscore
# 获取数据和报告（打印输出）
data, report = analyze_beneish_mscore("600519")
# 访问数据
latest_mscore = data.iloc[-1]['M-Score']
# 保存报告到文件
with open('report.txt', 'w', encoding='utf-8') as f:
    f.write(report)
# 静默模式（不打印任何输出）
data, report = analyze_beneish_mscore("600519", print_output=False)
