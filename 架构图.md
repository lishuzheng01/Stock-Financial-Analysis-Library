# 股票分析MCP服务器 - 框架图

## 项目概述
这是一个基于FastMCP的股票分析服务器，提供多种财务分析工具，包括历史数据获取、Altman Z-Score破产风险分析、Beneish M-Score财务操纵检测和Benford定律检查。

## 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                   股票分析MCP服务器                          │
│              (Stock Analysis MCP Server)                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   MCP服务器层 (MCP Server Layer)             │
│  src/MCP/server.py - FastMCP服务器实现                       │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  FastMCP服务器 (FastMCP Server)                         │ │
│  │  - 股票历史数据获取工具 (get_stock_data Tool)           │ │
│  │  - Altman Z-Score分析工具 (analyze_altman_zscore Tool)  │ │
│  │  - Beneish M-Score分析工具 (analyze_beneish_mscore Tool)│ │
│  │  - Benford定律检查工具 (check_benford Tool)             │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                  股票工具层 (Stock Tool Layer)               │
│  src/stock_tool/ - 核心分析工具模块                         │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐   │
│  │ get_stock_ │   Altman    │  Beneish    │  check_     │   │
│  │   data.py  │  ZScore.py  │ MScore.py   │ benford.py  │   │
│  │            │             │             │             │   │
│  │ 历史数据获取│ 破产风险分析│财务操纵检测 │ Benford检查 │   │
│  └─────────────┴─────────────┴─────────────┴─────────────┘   │
│                              │                               │
│                              ▼                               │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │              get_report_data.py                         │ │
│  │           (财务报告数据获取 - 共享模块)                  │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                  数据源层 (Data Source Layer)                │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                    AKShare库                            │ │
│  │        (开源股票数据接口 - 中国A股数据)                  │ │
│  └─────────────────────────────────────────────────────────┘ │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                src/stock_code/                          │ │
│  │              mainboard_codes.csv                        │ │
│  │               (主板股票代码列表)                         │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘


## 配置和测试层
┌─────────────────────────────────────────────────────────────┐
│  src/MCP/stock_mcp_config.json - MCP服务器配置               │
│  src/MCP/test_*.py - 单元测试文件                           │
│  readme.md - 项目文档                                       │
└─────────────────────────────────────────────────────────────┘
```

## 详细模块说明

### 1. MCP服务器层 (MCP Server Layer)
- **文件**: `src/MCP/server.py`
- **核心组件**: FastMCP服务器实例
- **功能**: 
  - 提供4个主要分析工具接口
  - 处理客户端请求和响应
  - 错误处理和日志记录

### 2. 股票工具层 (Stock Tool Layer)
- **位置**: `src/stock_tool/`
- **主要模块**:
  - `get_stock_data.py`: 获取股票历史K线数据
  - `AltmanZScore.py`: Altman Z-Score破产风险分析
  - `BeneishMScore.py`: Beneish M-Score财务操纵检测
  - `check_benford.py`: Benford定律数据检查
  - `get_report_data.py`: 财务报告数据获取（共享模块）

### 3. 数据源层 (Data Source Layer)
- **AKShare库**: 提供中国A股市场数据
- **本地数据**: `mainboard_codes.csv` 主板股票代码列表

## 数据流图

```
客户端请求
    │
    ▼
MCP服务器 (server.py)
    │
    ▼
工具路由 (根据请求类型)
    ├─→ get_stock_data.py (历史数据)
    ├─→ AltmanZScore.py (破产风险分析)
    ├─→ BeneishMScore.py (财务操纵检测)
    └─→ check_benford.py (数据质量检查)
        │
        ▼
    get_report_data.py (财务数据获取)
        │
        ▼
    AKShare API (数据源)
        │
        ▼
分析结果返回客户端
```

## 核心功能特性

1. **多维度财务分析**: 提供破产风险、财务操纵、数据质量等多角度分析
2. **标准化数据接口**: 统一的股票数据获取和财务报告数据接口
3. **MCP协议支持**: 兼容Model Context Protocol，可与AI助手集成
4. **模块化设计**: 各分析工具独立封装，便于维护和扩展
5. **错误处理**: 完善的异常处理和用户友好的错误信息

## 技术栈

- **后端框架**: FastMCP (基于FastAPI)
- **数据处理**: Pandas, NumPy
- **数据源**: AKShare (中国A股数据)
- **配置**: JSON配置文件
- **测试**: 单元测试框架

这个架构设计具有良好的扩展性，可以轻松添加新的分析工具或数据源。