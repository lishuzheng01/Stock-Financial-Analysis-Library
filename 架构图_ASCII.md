# 股票分析MCP服务器 - ASCII架构图

## 整体架构概览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          股票分析MCP服务器                               │
│                      Stock Analysis MCP Server                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            MCP服务器层                                   │
│                          MCP Server Layer                               │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                    src/MCP/server.py                                │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │ │
│  │  │                    FastMCP服务器                                │ │ │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │ │ │
│  │  │  │ 股票历史数据 │  │ Altman     │  │ Beneish     │  │ Benford │ │ │ │
│  │  │  │  获取工具    │  │ Z-Score    │  │ M-Score     │  │ 检查工具 │ │ │ │
│  │  │  │             │  │  分析工具   │  │  分析工具   │  │         │ │ │ │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │ │ │
│  │  └─────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            股票工具层                                    │
│                           Stock Tool Layer                              │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐ │
│  │ get_stock_  │  │   Altman    │  │  Beneish    │  │    check_       │ │
│  │   data.py   │  │  ZScore.py  │  │  MScore.py  │  │   benford.py    │ │
│  │             │  │             │  │             │  │                 │ │
│  │ 历史数据获取 │  │ 破产风险分析 │  │财务操纵检测 │  │  Benford检查    │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────┘ │
│                                    │                                    │
│                                    ▼                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                     get_report_data.py                              │ │
│  │                  (财务报告数据获取 - 共享模块)                       │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                             数据源层                                     │
│                           Data Source Layer                             │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                          AKShare库                                  │ │
│  │                  (开源股票数据接口)                                 │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
│  ┌─────────────────────────────────────────────────────────────────────┐ │
│  │                     mainboard_codes.csv                             │ │
│  │                    (主板股票代码列表)                               │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘


## 数据流向图

```
客户端请求
    │
    ▼
┌─────────────┐
│ MCP服务器   │
│ (server.py) │
└─────────────┘
    │
    ▼
┌─────────────────┐
│   工具路由      │
│ (Tool Router)   │
└─────────────────┘
    ├─→ get_stock_data.py ──→ AKShare API ──→ 返回历史数据
    ├─→ AltmanZScore.py ──→ get_report_data.py ──→ AKShare API ──→ 返回Z-Score分析
    ├─→ BeneishMScore.py ──→ get_report_data.py ──→ AKShare API ──→ 返回M-Score分析
    └─→ check_benford.py ──→ 数据检查 ──→ 返回Benford分析结果
        │
        ▼
    返回分析结果给客户端
```

## 模块依赖关系

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  server.py  │───→│ get_stock_  │───→│  AKShare    │
│ (MCP Server)│    │  data.py    │    │   API       │
└─────────────┘    └─────────────┘    └─────────────┘
        │                  │                  │
        ├──────────────────┼──────────────────┘
        │                  │
        ▼                  ▼
┌─────────────┐    ┌─────────────┐
│ AltmanZScore│───→│get_report_  │
│    .py      │    │ data.py     │
└─────────────┘    └─────────────┘
        │                  │
        ├──────────────────┘
        │
        ▼
┌─────────────┐
│BeneishMScore│
│    .py      │
└─────────────┘
        │
        ▼
┌─────────────┐
│ check_      │
│ benford.py  │
└─────────────┘
```

## 核心分析模型

### 1. Altman Z-Score模型 (破产风险预测)
```
Z-Score = 1.2*X1 + 1.4*X2 + 3.3*X3 + 0.6*X4 + 1.0*X5

X1 = 营运资本 / 总资产
X2 = 留存收益 / 总资产  
X3 = 息税前利润 / 总资产
X4 = 股东权益市值 / 总负债
X5 = 销售收入 / 总资产

风险评估:
- Z > 2.99: 安全区域 (Safe Zone)
- 1.81 < Z < 2.99: 灰色区域 (Grey Zone)  
- Z < 1.81: 危险区域 (Distress Zone)
```

### 2. Beneish M-Score模型 (财务操纵检测)
```
8个财务比率指标，检测财务报表操纵风险
```

### 3. Benford定律检查 (数据质量验证)
```
验证财务数据是否符合自然数据分布规律
常用于审计和欺诈检测
```

这个架构展示了项目的模块化设计和清晰的数据流向，便于理解和维护。